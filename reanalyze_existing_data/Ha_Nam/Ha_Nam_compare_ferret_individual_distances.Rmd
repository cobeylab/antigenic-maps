---
title: "Ha_Nam individual distance analysis"
output: html_notebook
---

# Background

** Definition of antigenic distance **

The antigenic distance between influenza strains is typically estimated from serological panel data estimated using antisera from naive lab ferrets infected with a single reference strain.
Each ferret generates a primary antibody response specific to the infecting strain, i.
The titer of each antiserum against a panel of heterologous strains indicates how well antibodies specific to strain i cross-react with other strains (j).
If an antiserum's heterologous titer to strain j is much less than the heterologous titer to strain i, then we conclude that the antigenic distance $d_{ij}$ is large, and that i and j weakly cross-react.
Formally, if $s_{ii}$ represents the homologous log$_2$ titer between antiserum i and strain i, and $s_{ij}$ represents the heterologous log$_2$ titer to j, then antigenic distance is defined as

$$ d_{ij} = s_{ii}-s_{ij}  $$ (equation 1)

(Neher et al. 2016). Titers are often reported on the log$_2$ scale to reflect 2-fold serial dilutions used in titer measurement. Equation 1 summarized the conceptual foundaiton for many distance calculations, although some studies use slight variations of this definition, e.g. by adjusting for serum potency and strain avidity (Bedford et al. 2014; Smith et al. 2004; Cai et al. 2010).


** Interpretation **

Strictly speaking, antigenic distances should be interpreted as the extent to which antibodies in a primary ferret antiserum rasied against strain i cross-react with strain j.
But in practice, antigenic distance estimates are widely used to model population susceptibilty, to estimate the novelty (and implicitly the fitness) of new variants, and to guide vaccine strain selection.
In these contexts, ferret distance estimates are used as a proxy for the expected level of cross-reactivity between a human antibody reponse to a recent strain i, and a new variant j.
There is a need to systematically assess whether ferret distances accurately and precisely estimate individual cross-reactivity (and heterogeneity in it) against new antigenic variants of influenza, Sars-Cov-2, etc.


# Approach

We calculate **individual distances** using sera collected from individuals who were recently infected by or vaccinated with a known strain. Specifically, this analysis focuses on data from the Ha Nam cohort, available in the supplement of Fonville et al. 2014. This dataset includes sera from:

* 12 individuals from a household cohort study with PCR-confirmed infections (all unvaccinated)
* 56 individuals from a household cohort study with no known history of PCR-confirmed infection (all unvaccinated)
* 106 individuals vaccinated in 1995 with A/Nangchang933/95
* 128 individuals vaccinatd in 1997 with A/Sydney/5/97
* 82 individuals vacinated in 2009 with ??
* 82 individuals vaccinated in 2010 with ??


## 12 individuals with PCR-confirmed infections 
(all unvaccinated)

```{r include=FALSE}
rm(list = ls())
library(ggplot2)
library(tidyr)
library(dplyr)
filter <- dplyr::filter
```

```{r}
normalize_HaNam_titers = function(titer_col){
  titer_col = ifelse(titer_col == '*', NA, titer_col)
  titer_col = ifelse(titer_col == '<10', 5, titer_col)
  titer_col = ifelse(titer_col == '>=1280', 1280, titer_col)
  as.numeric(titer_col)
}

to_log = function(titer){
  log2(titer/5)
}

clean_years = function(years){
  years = as.numeric(years)
  ifelse(years<20, years+2000, 
         ifelse(years<100, years+1900,
         years))
}

get_HaNam_homologous_titer_for_individual = function(titers,  is_vietnam_titer){
  if(any(is_vietnam_titer)){
    homologous_titer = mean(titers[is_vietnam_titer])
  }else{
    homologous_titer = mean(titers)
  }
  homologous_titer
}

get_HaNam_strains_chronologically <- function(){
  read_csv('HaNam_strains.csv')  %>%
    tidyr::extract(col = test_strain, into = 'test_strain_year', regex = '/(\\d+)$', remove = F) %>%
    mutate(test_strain_year = clean_years(test_strain_year)) %>%
    arrange(test_strain_year) %>%
    pull(full_name)
}

get_vaccine_study_strains_chronologically <- function(study_year){
  read_csv(paste0('vaccine_study_', study_year, '_strains.csv'), show_col_types = FALSE)  %>%
    arrange(test_strain_year) %>%
    pull(full_name)
}

extract_pairwise_ditance <- function(strain1_name, strain2_name, ag_coords = ag_coords){
  v1 = ag_coords %>%
    filter(viruses == strain1_name) %>%
    select(-viruses) %>%
    unlist()
  v2 = ag_coords %>%
    filter(viruses == strain2_name) %>%
    select(-viruses) %>%
    unlist()
  stopifnot(length(v1) == length(v2))
  sqrt(sum((v1-v2)^2))
}

get_recent_ferret_distances <- function(sample_year,
                                        last_n_years){
  dist_table %>%
    tidyr::extract(col = strain1, into = 'strain1_year', regex = '/(\\d+)$', remove = F) %>%
    mutate(strain1_year = clean_years(strain1_year)) %>%
    ## Keep strain 1s from the past n years
    filter(strain1_year %in% (sample_year - (0:(last_n_years)))) %>%
    distinct() %>%
    group_by(strain2) %>%
    ## Calculate the mean distance beteen valid strain1s and each strain2
    summarise(mean_ferret_distance = mean(ferret_distance),
              median_ferret_distance = median(ferret_distance)) %>%
    mutate(sample_year = sample_year,
           last_n_years = last_n_years)
}


get_recent_individual_distances <- function(sample_year,
                                            last_n_years,
                                            non_infections){
  
  #library(doParallel)
  #doParallel::registerDoParallel(parallel::makeCluster(5))
  foreach(subject_id = unique(non_infections$`Subject number`),
          .export = 'non_infections') %do% {
      xx = filter(non_infections,
                  `Subject number` == subject_id) %>%
        filter(`Sample year` == sample_year) %>%
        rename(sample_year = `Sample year`,
              id = `Subject number`)
  
  merge(
    ## Recent strains
    xx %>%
      filter(test_strain_year %in% (sample_year - (0:(last_n_years)))) %>%
      rename(recent_strain = test_strain,
             recent_strain_titer = logtiter) ,
    ## All panel strains
    xx %>% 
      rename(test_strain_titer = logtiter),
    by = 'id', all = TRUE
  ) %>%
    ## For each recent-panel strain, get the titer difference
    mutate(pairwise_distance = recent_strain_titer - test_strain_titer) %>%
    group_by(test_strain) %>%
    summarise(median_dist_to_recent_strains = median(pairwise_distance)) %>%
    ungroup() %>%
    mutate(`Subject number` = subject_id,
           `Sample year` = sample_year,
           last_n_years = last_n_years) 
  } %>%
    bind_rows()
}





plot_non_infections = function(n_years_back ## How many years back from the sample year should be included in recent strain comparison?
                               ){
sample_years = unique(non_infections$`Sample year`)
xx = merge(
  ## recent_ferret_distances
  lapply(sample_years, FUN = function(ll) get_recent_ferret_distances(ll, last_n_years = n_years_back )) %>%
    bind_rows() %>%
    rename(test_strain = strain2),
  ## recent individual distances
  lapply(sample_years, FUN = function(ll) get_recent_individual_distances(ll, last_n_years = n_years_back, non_infections)) %>%
    bind_rows() %>%
   tidyr::extract(col = test_strain, into = 'test_strain_year', regex = '/(\\d+)$', remove = F) %>%
  mutate(test_strain_year = clean_years(test_strain_year)) 
) 



for(yy in sample_years){
  recent_start_year = yy - n_years_back
  xx %>%
    filter(sample_year == yy) %>%
    mutate(test_strain = factor(test_strain, levels = xx %>% select(starts_with('test_strain')) %>%
                                  arrange(test_strain_year) %>%
                                  distinct() %>%
                                  pull(test_strain)),
           xval = as.numeric(test_strain),
           last_n_years = factor(last_n_years),
           is_sample_year = sample_year == test_strain_year) %>%
    ggplot() +
    geom_violin(aes(x = test_strain, y = median_dist_to_recent_strains, color = is_sample_year), draw_quantiles = .5) +
    # geom_point(aes(x = jitter(xval), y = median_dist_to_recent_strains, color = is_sample_year), alpha = .1) +
    geom_segment(aes(x = xval-.3, xend = xval+0.3, y = median_ferret_distance, yend = median_ferret_distance, color = last_n_years))+
    theme(axis.text.x = element_text(angle = 70, hjust = 1))+
   # facet_wrap(.~sample_year, labeller = label_both) +
    theme(legend.position = 'none')+
    ylab(sprintf('median distance to recent strains\n(%i seasons prior to sample)', n_years_back))+
    xlab('test_strain') +
    ggtitle(sprintf('Sample year: %i \nRecent strains include %i-%i', yy, recent_start_year, yy))
 ggsave(filename = sprintf('plots/HaNam_non_infections_%iyearsback_sampleyear%i.png', n_years_back, yy), width = 12, height = 7, units = 'in', dpi = 200)
}
}
```



## Read in antigenic distances
```{r}
ag_coords = read_csv('Fonville_antigen_coords.csv')

all_test_strains = bind_rows(read_csv('vaccine_study_1995_strains.csv'),
                             read_csv('vaccine_study_1997_strains.csv'),
                             read_csv('vaccine_study_2009_strains.csv'),
                             read_csv('vaccine_study_2010_strains.csv'),
                             read_csv('HaNam_strains.csv')) %>%
  mutate(full_name = toupper(full_name)) %>%
  distinct() %>% 
  arrange(full_name)

## Verify that all strains have estimated coordinates
all_test_strains %>% 
  mutate(has_coord = full_name %in% ag_coords$viruses) %>%
  filter(!has_coord)

## Get pairwise distances
dist_table = expand_grid(strain1 = ag_coords$viruses,
                         strain2 = ag_coords$viruses) %>%
  rowwise() %>%
  mutate(ferret_distance = extract_pairwise_ditance(strain1, strain2, ag_coords)) %>%
  ungroup()
```


```{r include=FALSE}
## Read in titers
HaNam_titers = read_csv('Fonville_2014_TableS3.csv') %>% ## HaNam cohort titers
  mutate_at(-c(1,2), .funs = ~normalize_HaNam_titers(.)) %>% ## Convert titer values to numeric. Report undetectable = 5, and endpoint = 1280
  pivot_longer(-c(1,2), names_to = 'test_strain', values_to = 'titer') %>%
  filter(!test_strain == 'A/PHILIPPINES/472/2002_EGG') %>% ## Filter out the Egg adapted version of A/PHILIPPINES/472/2002
  mutate(test_strain = ifelse(test_strain == 'A/PHILIPPINES/427/2002_MDCK', 'A/PHILIPPINES/472/2002', test_strain)) %>%
  mutate(logtiter = to_log(titer)) %>%
  tidyr::extract(col = test_strain, into = 'test_strain_year', regex = '/(\\d+)$', remove = F) %>%
  mutate(test_strain_year = clean_years(test_strain_year)) %>%
  merge(read_csv('YOB_inferred.csv'), by = 'Subject number') %>% ## Merge with Kangchon's annotation of PCR-confirmed infections %>%
  merge(read_csv('HaNam_strains.csv'), by = 'test_strain') %>%
  mutate(test_strain = full_name) %>%
  select(`Subject number`, YOB, Notes, `Infection Time`, `Sample year`, test_strain, is_vietnam_strain, test_strain_year, titer, logtiter) 
```

## Extact and analyze PCR-confirmed infections
```{r}
PCR_infections = HaNam_titers %>%
  dplyr::filter(Notes == 'PCR+') %>%
  filter(`Sample year` == `Infection Time`) %>%
  filter(!is.na(titer)) %>%
  mutate(is_infecting_year = test_strain_year == `Infection Time`) %>%
  select(`Subject number`, `Infection Time`, `test_strain`, is_vietnam_strain, is_infecting_year, test_strain_year, logtiter, `Sample year`, YOB) %>%
  group_by(`Subject number`) %>%
  mutate(is_homologous_strain = if(any(is_vietnam_strain & is_infecting_year)){ is_vietnam_strain & is_infecting_year } else {is_infecting_year},
         homologous_titer = mean(logtiter[is_homologous_strain]),
         individual_distance = homologous_titer-logtiter) 

homologous_strain_table = filter(PCR_infections, is_homologous_strain) %>%
  ungroup() %>%
  select(`Infection Time`, test_strain) %>%
  distinct() %>%
  rename(homologous_strain = test_strain)



  
PCR_infections = merge(PCR_infections,
      homologous_strain_table,
      by = 'Infection Time', all = TRUE) %>% 
  mutate(test_strain = toupper(test_strain),
         homologous_strain = toupper(homologous_strain)) %>%
   merge(dist_table %>% 
            rename(test_strain = strain2, 
                   homologous_strain = strain1),
          by = c('homologous_strain', 'test_strain'), all_x = TRUE, all_y = FALSE)
```

```{r warning=FALSE}
library(foreach)
foreach(this_infection_year = unique(PCR_infections$`Infection Time`)) %do% {
  these_data = PCR_infections %>%
    filter(`Infection Time` == this_infection_year) %>%
  ungroup() 
  
  these_data %>%
    mutate(`Subject number` = as.factor(`Subject number`),
           test_strain = factor(test_strain, levels = these_data %>%
                                  select(starts_with('test_strain')) %>%
                                  arrange(test_strain_year) %>% 
                                  distinct() %>%
                                  pull(test_strain)),
           test_strain_year = as.factor(test_strain_year),
           x_val = jitter(as.numeric(test_strain)),
           xval_homologous_label = ifelse(is_homologous_strain, test_strain, NA)) %>%
  ggplot() +
  geom_boxplot(aes(x = test_strain, y = ferret_distance), color = 'indianred3')+
  #geom_violin(aes(x = test_strain, y = individual_distance)) +
  geom_point(aes(x = x_val, y = individual_distance, color = `Subject number`)) +
  geom_point(aes(x = xval_homologous_label, y = -7.5), color = 'red', pch = 8)+
  #geom_segment(aes(x = as.numeric(test_strain)-0.3, xend = as.numeric(test_strain)+0.3, y = ferret_distance, yend = ferret_distance), color = 'indianred3')+
  theme(axis.text.x = element_text(angle = 70, hjust = 1))+
  ggtitle(sprintf('Infection year: %s', this_infection_year))+
    scale_color_viridis_d()
 ggsave(filename = sprintf('plots/HaNam_PCR_infections_%s.png', this_infection_year), width = 12, height = 7, units = 'in', dpi = 200)
}

```


## Extact and analyze non-PCR confirmed infections
```{r warning=FALSE}
non_infections = HaNam_titers %>%
  dplyr::filter(is.na(Notes)) %>%
  filter(!is.na(titer)) %>%
  select(`Subject number`, `test_strain`, is_vietnam_strain,  test_strain_year, logtiter, `Sample year`, YOB) 
```

```{r include=FALSE}
plot_non_infections(n_years_back = 0)
```

```{r include=FALSE}
plot_non_infections(n_years_back = 1)
```

```{r include=FALSE}
plot_non_infections(n_years_back = 5)
```






```{r warning=FALSE}
library(foreach)
foreach(this_infection_year = unique(PCR_infections$`Infection Time`)) %do% {
  PCR_infections %>%
    filter(`Infection Time` == this_infection_year) %>%
  ungroup() %>%
    mutate(`Subject number` = as.factor(`Subject number`),
           test_strain = factor(test_strain, levels = PCR_infections %>%
                                  select(starts_with('test_strain')) %>%
                                  arrange(test_strain_year) %>% 
                                  distinct() %>%
                                  pull(test_strain)),
           test_strain_year = as.factor(test_strain_year),
           x_val = jitter(as.numeric(test_strain)),
           xval_homologous_label = ifelse(is_homologous_strain, test_strain, NA)) %>%
  ggplot() +
  geom_boxplot(aes(x = test_strain, y = ferret_distance), color = 'indianred3')+
  #geom_violin(aes(x = test_strain, y = individual_distance)) +
  geom_point(aes(x = x_val, y = individual_distance, color = `Subject number`)) +
  geom_point(aes(x = xval_homologous_label, y = -7.5), color = 'red', pch = 8)+
  #geom_segment(aes(x = as.numeric(test_strain)-0.3, xend = as.numeric(test_strain)+0.3, y = ferret_distance, yend = ferret_distance), color = 'indianred3')+
  theme(axis.text.x = element_text(angle = 70, hjust = 1))+
  ggtitle(sprintf('Infection year: %s', this_infection_year))+
  geom_hline(aes(yintercept = 0), lty = 3) +
    scale_color_viridis_d()
 ggsave(filename = sprintf('plots/HaNam_PCR_infections_%s.png', this_infection_year), width = 12, height = 7, units = 'in', dpi = 200)
}

```




## NEED TO GET AND ADD FERRET DISTANCES




------------------

## 106 individuals vaccinated with A/Nangchang933/95

```{r}
repair_names = function(name, df){
  paste0(
    gsub(pattern = '(.+\\w)...\\d?\\d?\\d$', replacement = '\\1', x = name),
    '-',
    df[1,name]
  )
}

prelim_vaccine_study_import <- function(csv_filename){
  temp =read_csv(csv_filename)
names(temp) = c('subject', 'age', 
                             sapply(names(temp)[-c(1,2)], FUN = function(xx){
                               repair_names(xx, temp)}
                               ))
temp
}




process_vaccination_study_data <- function(titer_filename,
                                           strain_fiename,
                                           homologous_strain_name){
  
  prelim_vaccine_study_import(titer_filename) %>%  ## Import raw vaccine study titer csv
    slice(-1) %>% ## Drop the row with pre/post labels
    mutate_at(-c(1,2), .funs = ~normalize_HaNam_titers(.)) %>% ## Convert titer values to numeric. Report undetectable = 5 --> logtiter = 0
    pivot_longer(-c(1,2), names_to = c('test_strain', 'timepoint'), values_to = 'titer', names_sep = '-') %>% ## Pivot to long
    filter(!test_strain == 'A/PHILIPPINES/472/2002_EGG') %>% ## Filter out the Egg adapted version of A/PHILIPPINES/472/2002
    mutate(test_strain = ifelse(test_strain == 'A/PHILIPPINES/427/2002_MDCK', 'A/PHILIPPINES/472/2002', test_strain)) %>% ## Rename the MDCK-passaged version using the standard format
    merge(read_csv(strain_fiename)) %>% ## Merge with a strain name dictionary in which I've manually standardized the names to follow the same format
    mutate(test_strain = full_name) %>% ## Replace names with human-edited names in the standard format
    select(-full_name) %>% ## Drop the redundant column from the dictionary
    mutate(logtiter = to_log(titer)) %>% ## Get the log titer
    tidyr::extract(col = test_strain, into = 'test_strain_year', regex = '/(\\d+)$', remove = F) %>%
    mutate(test_strain_year = clean_years(test_strain_year))  %>%  ## Extract and clean the year of test strain circulation from the strain name
    group_by(subject, timepoint) %>% ## Get the homologous titer and distance
    mutate(is_homologous_strain = test_strain == homologous_strain_name,
           homologous_strain = homologous_strain_name,
           homologous_titer = mean(logtiter[is_homologous_strain]),
           individual_distance = homologous_titer-logtiter)  %>%
    ## Merge with ferret distances
    merge(dist_table %>% 
            filter(strain1 == homologous_strain_name) %>% 
            rename(test_strain = strain2, 
                   homologous_strain = strain1),
          by = c('homologous_strain', 'test_strain'), all_x = TRUE, all_y = FALSE
    )
  
}



plot_vaccine_study_by_strain <- function(titer_data_frame,
                                         study_year,
                                         return_plot = TRUE){

  
plot_data = titer_data_frame %>%
    ungroup() %>%
    mutate(subject = as.factor(subject),
           test_strain = factor(test_strain, levels = get_vaccine_study_strains_chronologically(study_year)),
           test_strain_year = as.factor(test_strain_year),
           x_val = jitter(as.numeric((`test_strain`))),
           xval_homologous_label = ifelse(is_homologous_strain, test_strain, NA)) 

count_table = plot_data %>%
    group_by(test_strain, timepoint) %>%
    dplyr::summarise(n_individuals = n()) %>%
    ungroup() %>%
  mutate(label = sprintf('n=%i', n_individuals))

this_plot =  plot_data %>%
  ggplot() +
  geom_violin(aes(x = test_strain, y = individual_distance)) +
  geom_point(aes(x = x_val, y = jitter(individual_distance), color = test_strain_year), show.legend = F, alpha = .1) +
  geom_point(aes(x = xval_homologous_label, y = -7.5), color = 'red', pch = 8)+
  geom_segment(aes(x = as.numeric(test_strain)-0.3, xend = as.numeric(test_strain)+0.3, y = ferret_distance, yend = ferret_distance), color = 'indianred3')+
  geom_text(aes(x = test_strain, y = -8.5, label = label), data = count_table, angle = 45, size = 2.5) +
  geom_hline(aes(yintercept = 0), lty = 3) +
  facet_wrap(timepoint~., labeller = 'label_both',ncol = 1) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  ylim(c(-9.5, max(plot_data$individual_distance))) +
  ylab('individual distance\n[homoogous titer]-[heterologous titer]')+
  xlab('test strain') 
filename = paste0('plots/vaccine_study_', study_year, '_bystrain.png')
ggsave(filename = filename, width = 17, height = 9, units = 'in', dpi = 200)
cat(sprintf('saved plot to %s', filename))
if(return_plot == TRUE) return(this_plot)
}

plot_vaccine_study_by_year <- function(titer_data_frame,
                                       study_year,
                                       return_plot = TRUE){
  plot_data = titer_data_frame %>%
    ungroup() %>%
    mutate(subject = as.factor(subject),
           test_strain_year = factor(test_strain_year),
           x_val = jitter(as.numeric(test_strain_year)),
           xval_homologous_label = ifelse(test_strain_year==study_year, test_strain_year, NA)) 
  
  
  count_table = plot_data %>%
    group_by(test_strain_year, timepoint) %>%
    dplyr::summarise(n_individuals = n(),
                     n_test_strains = length(unique(test_strain))) %>%
    ungroup() %>%
  mutate(label_indiv = sprintf('n=%i', n_individuals),
         label_strains = sprintf('s=%i', n_test_strains))
  
  
  this_plot = plot_data %>%
    ggplot() +
    geom_violin(aes(x = as.factor(test_strain_year), y = individual_distance), draw_quantiles = c(0.5)) +
    geom_boxplot(aes(x = test_strain_year, y = ferret_distance), color = 'indianred3', fill = NA)+
    geom_point(aes(x = x_val, y = jitter(individual_distance), color = test_strain_year), show.legend = F, alpha = .1) +
    geom_point(aes(x = xval_homologous_label, y = -7.5), color = 'red', pch = 8)+
    #geom_segment(aes(x = as.numeric(test_strain_year)-0.3, xend = as.numeric(test_strain_year)+0.3, y = ferret_distance, yend = ferret_distance), color = 'indianred3')+
    geom_text(aes(x = test_strain_year, y = -8.5, label = label_indiv), data = count_table, angle = 45, size = 2.5) +
    geom_text(aes(x = test_strain_year, y = max(plot_data$individual_distance)-5, label = label_indiv), data = count_table, angle = 45, size = 2.5, color = 'indianred3') +
    geom_hline(aes(yintercept = 0), lty = 3) +
    facet_wrap(timepoint~., labeller = 'label_both',ncol = 1) +
    theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
    ylim(c(-9, max(plot_data$individual_distance))) +
    ylab('individual distance\n[homoogous titer]-[heterologous titer]')+
    xlab('test strain') 
  filename = paste0('plots/vaccine_study_', study_year, '_byyear.png')
  ggsave(filename = filename, width = 17, height = 9, units = 'in', dpi = 200)
  cat(sprintf('saved plot to %s', filename))
  if(return_plot == TRUE) return(this_plot)
}
```









--------------------------

# 1995 vaccine study

```{r include=FALSE}
vaccinations_1995 = process_vaccination_study_data(titer_filename = 'Fonville_2014_TableS5.csv', 
                                                   strain_fiename = 'vaccine_study_1995_strains.csv', 
                                                   homologous_strain_name = 'A/NANCHANG/933/95')
```

```{r}
plot_vaccine_study_by_strain(vaccinations_1995, 1995)
```

```{r}
## Extract homologous titers, calculate individual distances, and plot
plot_vaccine_study_by_year(vaccinations_1995, 1995)
```





------------------

# 1997 vaccine study

## 128 individuals vaccinated with A/Sydney/5/97



```{r include=FALSE}
vaccinations_1997 = process_vaccination_study_data(titer_filename = 'Fonville_2014_TableS6.csv',
                                                   strain_fiename = 'vaccine_study_1997_strains.csv', 
                                                   homologous_strain_name = 'A/SYDNEY/5/97')
```
```{r}
plot_vaccine_study_by_strain(vaccinations_1997, 1997)
```

```{r}
plot_vaccine_study_by_year(vaccinations_1997, 1997)
```









------------------

# 2009 vaccine study



```{r}
vaccinations_2009 = process_vaccination_study_data('Fonville_2014_TableS13.csv', 'vaccine_study_2009_strains.csv', 'A/PERTH/16/2009')
```
```{r}
plot_vaccine_study_by_strain(vaccinations_2009, 2009)
```



```{r}
plot_vaccine_study_by_year(vaccinations_2009, 2009)
```








------------------

## 2010 vaccine study



```{r}
vaccinations_2010 = process_vaccination_study_data('Fonville_2014_TableS14.csv',  
                                                  'vaccine_study_2010_strains.csv', 
                                                   'A/VIETNAM/53/2010') 
```
```{r}
plot_vaccine_study_by_strain(vaccinations_2010, 2010)
```


```{r}
plot_vaccine_study_by_year(vaccinations_2010, 2010)
```

